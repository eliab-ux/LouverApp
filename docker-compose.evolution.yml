version: '3.8'

services:
  evolution-api:
    image: atendai/evolution-api:latest
    container_name: evolution-api-louvorapp
    ports:
      - "8080:8080"
    environment:
      # Configurações básicas
      SERVER_URL: http://localhost:8080

      # Autenticação da API
      AUTHENTICATION_API_KEY: louvorapp_dev_secret_key_2024

      # Database (PostgreSQL local para desenvolvimento)
      DATABASE_ENABLED: true
      DATABASE_PROVIDER: postgresql
      DATABASE_CONNECTION_URI: postgresql://postgres:postgres@evolution-postgres:5432/evolution_local
      DATABASE_SAVE_DATA_INSTANCE: true
      DATABASE_SAVE_DATA_NEW_MESSAGE: true
      DATABASE_SAVE_MESSAGE_UPDATE: true
      DATABASE_SAVE_DATA_CONTACTS: true
      DATABASE_SAVE_DATA_CHATS: true

      # Configurações do WhatsApp
      QRCODE_COLOR: "#198754"
      TYPEBOT_ENABLED: false

      # Configurações de instância
      DEL_INSTANCE: false
      DEL_TEMP_INSTANCES: true

      # Logs
      LOG_LEVEL: INFO
      LOG_COLOR: true
      LOG_BAILEYS: error

      # Webhook (opcional - para debug)
      WEBHOOK_GLOBAL_ENABLED: false

    volumes:
      - evolution_instances:/evolution/instances
      - evolution_store:/evolution/store

    restart: unless-stopped

    networks:
      - louvorapp-network

    depends_on:
      - evolution-postgres

  evolution-postgres:
    image: postgres:15-alpine
    container_name: evolution-postgres-local
    environment:
      POSTGRES_USER: postgres
      POSTGRES_PASSWORD: postgres
      POSTGRES_DB: evolution_local
    volumes:
      - postgres_data:/var/lib/postgresql/data
    networks:
      - louvorapp-network
    restart: unless-stopped

volumes:
  evolution_instances:
    driver: local
  evolution_store:
    driver: local
  postgres_data:
    driver: local

networks:
  louvorapp-network:
    driver: bridge
